import { CodeSurfer } from "code-surfer";
import { vsDark } from "@code-surfer/themes";
import { images } from "./images";
import { future } from 'mdx-deck/themes';
import myTheme from "./theme";

export const themes = [future, myTheme];

# E2E & Frontend Testing Strategies

---

## Why should we test our code?

- To verify that it meets the **requirements**
- To avoid **regressions** after refactoring
- As a **documentation**
- To have a way to test specific cases that are difficult to test manually
- As a **guidance** that
    - force us to think about all cases
    - tells us when we can stop developing a feature

---

## Why aren't we testing our code?

- Writing good tests is **hard**
- We think that testing manually is enough and faster than writing automatic tests
- We think that writing tests is **expensive**

<img src={images.money} />

---

## Why aren't we testing our code?

> “Unit testing is a lot like going to the gym”

– [A random guy on Stackoverflow](https://stackoverflow.com/a/69263/9891450)

--- 

## Test Desiderata (1/2)

- **Isolated** — tests should return the same results regardless of the order in which they are run.
- **Composable** — if tests are isolated, then I can run 1 or 10 or 100 or 1,000,000 and get the same results.
- **Behavioral** — tests should be sensitive to changes in the behavior of the code under test. If the behavior changes, the test result should change.
- **Structure-insensitive** — tests should not change their result if the structure of the code changes.
- **Deterministic** — if nothing changes, the test result shouldn’t change.
- **Specific** — if a test fails, the cause of the failure should be obvious.

https://medium.com/@kentbeck_7670/test-desiderata-94150638a4b3

--- 

## Test Desiderata (2/2)

- **Fast** — tests should run quickly.
- **Writable** — tests should be cheap to write relative to the cost of the code being tested.
- **Readable** — tests should be comprehensible for reader, invoking the motivation for writing this particular test.
- **Automated** — tests should run without human intervention.
- **Predictive** — if the tests all pass, then the code under test should be suitable for production.
- **Inspiring** — passing the tests should inspire confidence

https://medium.com/@kentbeck_7670/test-desiderata-94150638a4b3

---

## Test Types: End To End (E2E)

Test the whole application (frontend + backend) like a user (usually from the browser)

---

## Test Types: End To End (E2E)

- ✅ Great **confidence** that everything works as expected
- ✅ Indipendent from the **code structure**
- ❌ **Slow**
- ❌ Difficult to make them **deterministic**
- ❌ Less **specific**
- ❌ No **TDD**

---

## Test Types: Unit tests

Test a **unit** of our code in **isolation** from the rest.

What is a unit?! 🤔

---

## Test Types: Unit tests

- ✅ **Fast**
- ✅ Very **specific**
- ✅ Easy to make them **deterministic**
- ✅ **TDD**
- ❌ Less **confidence** that everything works as expected
- ❌ Tied to the **code structure**
- ❌ Often require to **mock** a lot of things

---

<CodeSurfer theme={vsDark}>

```ts file=./code/icon-selector.component.ts
```

</CodeSurfer>

---

<CodeSurfer theme={vsDark}>

```ts file=./code/icon-selector.component.spec.ts
```

```ts 1:25 file=./code/icon-selector.component.spec.ts
```

```ts 10:12 file=./code/icon-selector.component.spec.ts
```

```ts 14:19 file=./code/icon-selector.component.spec.ts
``` 

```ts 28:33 file=./code/icon-selector.component.spec.ts
``` 

```ts 35:46 file=./code/icon-selector.component.spec.ts
``` 

</CodeSurfer>

---

## Test Types: Integration tests

Test a group of units and tests their behavior as a whole.

Usually in a frontend application we mean mocking the backend APIs

---

## Test Types: Integration tests

- ✅ Easy to make them **deterministic**
- ✅ Almost indipendent from the **code structure**
- ✅ Require to **mock** only external APIs
- ✅ **TDD**
- ❌ Less **confidence** that everything works as expected
- **Faster** than E2E tests, but **slower** than Unit tests
- Less **specific** than Unit tests, but more specific than E2E tests

---

<img src={images.unitIntegration} style={{ height: "80vh" }}/>

---

## Testing Pyramid

<img src={images.pyramid1} style={{ height: "70vh" }} />

<small>

https://martinfowler.com/bliki/TestPyramid.html

https://testing.googleblog.com/2015/04/just-say-no-to-more-end-to-end-tests.html

</small>

---

## Testing Trophy

<img src={images.pyramid2} style={{ height: "70vh" }} />

https://kentcdodds.com/blog/write-tests

---

## Other test types

- Smoke tests
- Visual regression tests ([Percy](https://percy.io/), [Applitools](https://applitools.com/))
- Load tests
- Penetration tests
- Contract testing
- Mutation tests ([Stryker](https://stryker-mutator.io/))
- Property based tests ([Fast-check](https://github.com/dubzzz/fast-check))
- ...

---

## Testing Tools

<img src={images.testingTools} />

---

## Links

- https://testingjavascript.com/
- https://github.com/goldbergyoni/javascript-testing-best-practices
- https://glebbahmutov.com/blog/
- https://kentcdodds.com/blog/
- https://github.com/NoriSte/ui-testing-best-practices
