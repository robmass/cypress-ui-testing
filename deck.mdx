import { highlight } from '@mdx-deck/themes';

export const theme = highlight;

# E2E & Frontend Testing Strategies

---

## Why should we test our code?

- To verify that it meets the **requirements**
- To avoid **regressions** after refactoring
- As a **documentation**
- To have a way to test specific cases that are difficult to test manually
- As a **guidance** that
    - force us to think about all cases
    - tells us when we can stop developing a feature

---

## Why aren't we testing our code?

- Writing good tests is **hard**
- We think that testing manually is enough and faster than writing automatic tests
- We think that writing tests is **expensive**

<img src={images.money} />

---

## Why aren't we testing our code?

<Steps>

> ‚ÄúUnit testing is a lot like going to the gym‚Äù

‚Äì [A random guy on Stackoverflow](https://stackoverflow.com/a/69263/9891450)

</Steps>

--- 

## Test Desiderata (1/2)

- **Isolated** ‚Äî tests should return the same results regardless of the order in which they are run.
- **Composable** ‚Äî if tests are isolated, then I can run 1 or 10 or 100 or 1,000,000 and get the same results.
- **Behavioral** ‚Äî tests should be sensitive to changes in the behavior of the code under test. If the behavior changes, the test result should change.
- **Structure-insensitive** ‚Äî tests should not change their result if the structure of the code changes.
- **Deterministic** ‚Äî if nothing changes, the test result shouldn‚Äôt change.
- **Specific** ‚Äî if a test fails, the cause of the failure should be obvious.

https://medium.com/@kentbeck_7670/test-desiderata-94150638a4b3

--- 

## Test Desiderata (2/2)

- **Fast** ‚Äî tests should run quickly.
- **Writable** ‚Äî tests should be cheap to write relative to the cost of the code being tested.
- **Readable** ‚Äî tests should be comprehensible for reader, invoking the motivation for writing this particular test.
- **Automated** ‚Äî tests should run without human intervention.
- **Predictive** ‚Äî if the tests all pass, then the code under test should be suitable for production.
- **Inspiring** ‚Äî passing the tests should inspire confidence

https://medium.com/@kentbeck_7670/test-desiderata-94150638a4b3

---

## Test Types: End To End (E2E)

Test the whole application (frontend + backend) like a user

- ‚úÖ Great **confidence** that everything works as expected
- ‚úÖ Indipendent from the **code structure**
- ‚ùå **Slow**
- ‚ùå Difficult to make them **deterministic**
- ‚ùå Less **specific**

---

## Test Types: Unit tests

Test a **unit** of our code in **isolation** from the rest.

What is a unit?! ü§î

- ‚úÖ **Fast**
- ‚úÖ Very **specific**
- ‚úÖ Easy to make them **deterministic**
- ‚ùå Less **confidence** that everything works as expected
- ‚ùå Tied to the **code structure**
- ‚ùå Often require to **mock** a lot of things

---

```ts
// icon-selector.component.ts

@Component({
  selector: 'app-icon-selector',
  templateUrl: './icon-selector.component.html',
  styleUrls: ['./icon-selector.component.sass']
})
export class IconSelectorComponent implements OnInit {
  @Input() currentIcon = '';

  icons = assetIcons;

  constructor(public activeModal: NgbActiveModal) {}

  ngOnInit() {}

  toggleSelected(icon: string) {
    this.currentIcon = icon;
  }

  close() {
    this.activeModal.close(this.currentIcon);
  }
}
```

---

```ts
// icon-selector.component.spec.ts

describe('IconSelectorComponent', () => {
  let component: IconSelectorComponent;
  let fixture: ComponentFixture<IconSelectorComponent>;
  let activeModalService: jasmine.SpyObj<NgbActiveModal>;
  let page: Page;

  beforeEach(async(() => {
    activeModalService = jasmine.createSpyObj<NgbActiveModal>([
      'close',
      'dismiss'
    ]);

    TestBed.configureTestingModule({
      imports: [TranslateTestingModule],
      declarations: [IconSelectorComponent, SvgIconComponent],
      providers: [{ provide: NgbActiveModal, useValue: activeModalService }]
    }).compileComponents();
  }));

  beforeEach(() => {
    fixture = TestBed.createComponent(IconSelectorComponent);
    component = fixture.componentInstance;
    page = new Page(fixture);
  });

  // ...

```

---

```ts
  // ...

  it('should call dismiss on cancel button click', () => {
    component.currentIcon = 'foo';
    fixture.detectChanges();
    page.cancelBtn.click();
    expect(activeModalService.dismiss).toHaveBeenCalled();
  });

  it('should close modal with selected icon on close', () => {
    component.currentIcon = 'foo';
    fixture.detectChanges();

    const bottleIconBtn = page.getIconBtn('bottle');
    bottleIconBtn!.click();
    fixture.detectChanges();

    page.selectBtn.click();

    expect(activeModalService.close).toHaveBeenCalledWith('bottle');
  });

});
```

---

## Test Types: Integration tests

Test a group of units and tests their behavior as a whole.

Usually in a frontend application we mean mocking the backend APIs

- ‚úÖ Easy to make them **deterministic**
- ‚úÖ Almost indipendent from the **code structure**
- ‚úÖ Require to **mock** only external APIs
- ‚ùå Less **confidence** that everything works as expected
- **Faster** than E2E tests, but **slower** than Unit tests
- Less **specific** than Unit tests, but more specific than E2E tests

---

<img src={images.unitIntegration} style={{ height: "80vh" }}/>

---

## Testing Pyramid

<img src={images.pyramid1} style={{ height: "70vh" }} />

<small>

https://martinfowler.com/bliki/TestPyramid.html

https://testing.googleblog.com/2015/04/just-say-no-to-more-end-to-end-tests.html

</small>

---

## Testing Trophy

<img src={images.pyramid2} style={{ height: "70vh" }} />

https://kentcdodds.com/blog/write-tests

---

## Links

- https://testingjavascript.com/
- https://github.com/goldbergyoni/javascript-testing-best-practices
- https://glebbahmutov.com/blog/
- https://kentcdodds.com/blog/
- https://github.com/NoriSte/ui-testing-best-practices
